<!doctype html><html lang=en theme=light is-docs-page js-focus-visible-polyfill-available><head><meta charset=utf-8><title>Use R2 from Workers ¬∑ Cloudflare R2 docs</title><meta http-equiv=cleartype content="on"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=application-name content="Use R2 from Workers ¬∑ Cloudflare R2 docs"><meta name=msapplication-tap-highlight content="no"><meta name=apple-mobile-web-app-title content="Use R2 from Workers ¬∑ Cloudflare R2 docs"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=apple-mobile-web-app-capable content="yes"><meta name=mobile-web-app-capable content="yes"><meta name=theme-color content="#f38020"><meta name=description content="Store large amounts of unstructured data without egress fees."><meta property="og:image" content="https://panthere2k.github.io/dev-products-preview.png"><meta property="og:title" content="Use R2 from Workers ¬∑ Cloudflare R2 docs"><meta property="og:description" content="Store large amounts of unstructured data without egress fees."><meta property="og:type" content="website"><meta name=twitter:title content="Use R2 from Workers ¬∑ Cloudflare R2 docs"><meta name=twitter:image content="https://panthere2k.github.io/dev-products-preview.png"><meta name=twitter:description content="Store large amounts of unstructured data without egress fees."><meta name=twitter:creator content="@cloudflare"><meta name=twitter:card content="summary_large_image"><meta name=pcx_content_type content="how-to"><link rel=icon href=/favicon-32x32.png><link rel=canonical href=https://panthere2k.github.io/r2/data-access/workers-api/workers-api-usage/><link rel=sitemap href=/sitemap.xml type=application/xml><link rel=manifest href=/manifest.webmanifest><link rel=apple-touch-icon sizes=48x48 href=/icons/icon-48x48.png><link rel=apple-touch-icon sizes=72x72 href=/icons/icon-72x72.png><link rel=apple-touch-icon sizes=96x96 href=/icons/icon-96x96.png><link rel=apple-touch-icon sizes=144x144 href=/icons/icon-144x144.png><link rel=apple-touch-icon sizes=192x192 href=/icons/icon-192x192.png><link rel=apple-touch-icon sizes=256x256 href=/icons/icon-256x256.png><link rel=apple-touch-icon sizes=384x384 href=/icons/icon-384x384.png><link rel=apple-touch-icon sizes=512x512 href=/icons/icon-512x512.png><script src=/search.redirect.min.6828ce878577fe91120d67814d68c0d8.js defer></script><link rel="stylesheet preconnect" href=/style.css><script>(function(){let s=!1,e,n;document.readyState!=="loading"?o():addEventListener("DOMContentLoaded",o),e=document.querySelector("#ThemeToggle"),s=!e;function t(n){try{let o=n?"dark":"light";document.documentElement.setAttribute("theme",o),localStorage.theme=JSON.stringify({theme:o}),e?(e.checked=n,s=!1):s&&setTimeout(t,1,n)}catch{}}function o(){e=e||document.querySelector("#ThemeToggle"),e.addEventListener("change",()=>t(!!e.checked)),addEventListener("keydown",n=>{n.target===document.body&&n.which===68&&n.shiftKey&&(n.preventDefault(),t(!e.checked))})}try{n=window.matchMedia("(prefers-color-scheme:dark)"),n.onchange=e=>t(e.matches)}catch{}try{let e=localStorage.theme,s=e&&JSON.parse(e);t(s?/dark/.test(s.theme):!!(n&&n.matches))}catch{}})()</script><script src=/main.min.c2a5e976c412695a3d9389cba84aa5bd.js defer></script>
<script data-source=docs defer src=https://feedback.developers.cloudflare.com/sdk.js></script>
<link rel=preload href=https://feedback.developers.cloudflare.com/sdk.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://feedback.developers.cloudflare.com/sdk.css></noscript></head><body><div class=DocsPage><div><a class=skip-link href=#main>Skip to content</a></div><div class=DocsMobileHeader><a class="DocsMobileHeader--cloudflare-logo-link Link Link-without-underline" href=/><div class="DocsNavLogoLockup DocsNavLogoLockup-with-small-gap"><div class=DocsNavLogoLockup--logo><svg viewBox="0 0 48 48" fill="currentcolor" role="img" aria-labelledby="title-27458391960035233" xmlns="http://www.w3.org/2000/svg"><title id="title-27458391960035233">Security365 Docs logomark</title><path d="M31.236 28.717c-.373-.548-1.003-.864-1.76-.9l-14.353-.195a.262.262.0 01-.221-.122.348.348.0 01-.035-.267.396.396.0 01.338-.268l14.48-.195c1.714-.085 3.58-1.533 4.232-3.309l.828-2.25a.503.503.0 00.023-.292c-.932-4.404-4.698-7.689-9.198-7.689-4.15.0-7.672 2.798-8.931 6.679a4.156 4.156.0 00-2.973-.864c-1.994.207-3.59 1.874-3.789 3.954a4.84 4.84.0 00.105 1.545c-3.253.097-5.853 2.871-5.853 6.29.0.304.024.608.059.912.023.146.14.256.28.256h26.488c.151.0.291-.11.338-.268l.198-.742c.245-.876.152-1.68-.256-2.275zm4.826-7.327c-.128.0-.268.0-.396.012-.093.0-.175.073-.21.17l-.56 2.032c-.244.876-.151 1.679.257 2.275.373.548 1.003.864 1.76.9l3.055.195c.093.0.175.049.222.122a.356.356.0 01.035.267.396.396.0 01-.339.268l-3.182.195c-1.726.085-3.58 1.532-4.232 3.309l-.234.62c-.046.122.035.243.164.243h10.935a.289.289.0 00.28-.219 8.654 8.654.0 00.292-2.214c0-4.501-3.521-8.175-7.847-8.175"/></svg></div><span class=DocsNavLogoLockup--text><span data-text=Cloudflare>Security365</span>
<span data-text=Docs>Docs</span></span></div></a></div><div class=DocsMobileTitleHeader><a aria-current=page class="DocsMobileTitleHeader--logo-link Link Link-without-underline" href=/r2/><div class="DocsNavLogoLockup DocsNavLogoLockup-with-small-gap"><div class=DocsNavLogoLockup--logo><span title="Cloudflare R2 logo"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40"><path fill-rule="evenodd" d="M30.289 6.423c-2.43-.813-5.958-1.362-9.977-1.362-4.018.0-7.545.549-9.976 1.362-1.228.41-2.033.842-2.48 1.195-.094.074-.16.134-.204.18.052.171.196.395.562.67.524.394 1.372.783 2.563 1.119 2.368.666 5.731 1.023 9.536 1.023 3.804.0 7.167-.357 9.535-1.023 1.191-.336 2.04-.725 2.563-1.119.366-.275.51-.499.562-.67a2.211 2.211.0 00-.204-.18c-.447-.353-1.252-.784-2.48-1.195zm-20.24 5.624c-.885-.25-1.71-.552-2.424-.922v4.393c0 .196.097.514.625.941.535.433 1.391.869 2.576 1.252 2.36.764 5.71 1.222 9.486 1.222 3.778.0 7.128-.458 9.487-1.222 1.185-.383 2.041-.82 2.576-1.252.528-.427.625-.745.625-.94v-4.394c-.715.37-1.539.673-2.424.922-2.7.76-6.336 1.124-10.264 1.124-3.927.0-7.564-.364-10.263-1.124zm25.576 3.471V7.622c0-2.829-6.856-5.122-15.313-5.122C11.857 2.5 5 4.793 5 7.622v24.756c0 2.829 6.856 5.122 15.313 5.122 8.456.0 15.312-2.293 15.312-5.122v-16.86zM33 19.134c-.7.393-1.505.726-2.375 1.008-2.708.877-6.358 1.352-10.313 1.352-3.954.0-7.604-.475-10.312-1.352-.87-.282-1.676-.615-2.375-1.008v4.28c0 .196.097.514.625.942.535.432 1.391.868 2.576 1.252 2.36.763 5.71 1.221 9.486 1.221 3.778.0 7.128-.458 9.487-1.221 1.185-.384 2.041-.82 2.576-1.252.528-.428.625-.746.625-.941v-4.28zm-23 8.904c-.87-.281-1.676-.615-2.375-1.007v5.143c.044.048.116.117.231.208.447.353 1.252.785 2.48 1.195 2.43.813 5.958 1.362 9.976 1.362 4.019.0 7.546-.549 9.977-1.362 1.228-.41 2.033-.842 2.48-1.195a2.03 2.03.0 00.231-.208v-5.143c-.7.392-1.505.726-2.375 1.007-2.708.877-6.358 1.352-10.313 1.352-3.954.0-7.604-.475-10.312-1.352zm23.06 4.06-.01.016a.059.059.0 01.01-.016zm-25.495.0.01.016a.06.06.0 01-.01-.016zm3.997-15.726c.725.0 1.313-.573 1.313-1.28.0-.708-.588-1.281-1.313-1.281-.724.0-1.312.573-1.312 1.28.0.708.588 1.281 1.313 1.281zm1.313 6.83c0 .706-.588 1.28-1.313 1.28-.724.0-1.312-.574-1.312-1.28.0-.708.588-1.281 1.313-1.281.724.0 1.312.573 1.312 1.28zm-1.313 9.176c.725.0 1.313-.573 1.313-1.28.0-.708-.588-1.28-1.313-1.28-.724.0-1.312.572-1.312 1.28.0.707.588 1.28 1.313 1.28z" clip-rule="evenodd"/></svg></span></div><span class=DocsNavLogoLockup--text><span class=DocsSidebar--docs-title-text-scaler style=--length:2>R2</span></span></div></a><button class="Button DocsMobileTitleHeader--sidebar-toggle-button">
<span class=DocsMobileTitleHeader--sidebar-toggle-button-icon aria-hidden=true><svg viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" role="img" aria-labelledby="title-1332672649688018" xmlns="http://www.w3.org/2000/svg"><title id="title-1332672649688018">Navigation menu icon</title><path data-index="1" d="M5 7h10" transform-origin="10 7"/><path data-index="2" d="M5 10h10" transform-origin="10 10"/><path data-index="3" d="M5 13h10" transform-origin="10 13"/></svg><span is-visually-hidden>Open external link</span></span></button></div><div class=DocsMobileNavBackdrop></div><div class=DocsSidebar><div class=DocsSidebar--sections><div class="DocsSidebar--section DocsSidebar--header-section"><a class="DocsSidebar--cloudflare-logo-link DocsSidebar--link" href=/><div class=DocsNavLogoLockup><div class=DocsNavLogoLockup--logo><svg viewBox="0 0 48 48" fill="currentcolor" role="img" aria-labelledby="title-27458391960035233" xmlns="http://www.w3.org/2000/svg"><title id="title-27458391960035233">Security365 Docs logomark</title><path d="M31.236 28.717c-.373-.548-1.003-.864-1.76-.9l-14.353-.195a.262.262.0 01-.221-.122.348.348.0 01-.035-.267.396.396.0 01.338-.268l14.48-.195c1.714-.085 3.58-1.533 4.232-3.309l.828-2.25a.503.503.0 00.023-.292c-.932-4.404-4.698-7.689-9.198-7.689-4.15.0-7.672 2.798-8.931 6.679a4.156 4.156.0 00-2.973-.864c-1.994.207-3.59 1.874-3.789 3.954a4.84 4.84.0 00.105 1.545c-3.253.097-5.853 2.871-5.853 6.29.0.304.024.608.059.912.023.146.14.256.28.256h26.488c.151.0.291-.11.338-.268l.198-.742c.245-.876.152-1.68-.256-2.275zm4.826-7.327c-.128.0-.268.0-.396.012-.093.0-.175.073-.21.17l-.56 2.032c-.244.876-.151 1.679.257 2.275.373.548 1.003.864 1.76.9l3.055.195c.093.0.175.049.222.122a.356.356.0 01.035.267.396.396.0 01-.339.268l-3.182.195c-1.726.085-3.58 1.532-4.232 3.309l-.234.62c-.046.122.035.243.164.243h10.935a.289.289.0 00.28-.219 8.654 8.654.0 00.292-2.214c0-4.501-3.521-8.175-7.847-8.175"/></svg></div><span class=DocsNavLogoLockup--text><span data-text=Cloudflare>Security365</span>
<span data-text=Docs>Docs</span></span></div></a></div><div class=DocsSidebar--section-separator></div><div class="DocsSidebar--section DocsSidebar--docs-title-section"><a aria-current=page class="DocsSidebar--docs-title-logo-link DocsSidebar--link" href=/r2/><div class=DocsNavLogoLockup><div class=DocsNavLogoLockup--logo><span title="Cloudflare R2 logo"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40"><path fill-rule="evenodd" d="M30.289 6.423c-2.43-.813-5.958-1.362-9.977-1.362-4.018.0-7.545.549-9.976 1.362-1.228.41-2.033.842-2.48 1.195-.094.074-.16.134-.204.18.052.171.196.395.562.67.524.394 1.372.783 2.563 1.119 2.368.666 5.731 1.023 9.536 1.023 3.804.0 7.167-.357 9.535-1.023 1.191-.336 2.04-.725 2.563-1.119.366-.275.51-.499.562-.67a2.211 2.211.0 00-.204-.18c-.447-.353-1.252-.784-2.48-1.195zm-20.24 5.624c-.885-.25-1.71-.552-2.424-.922v4.393c0 .196.097.514.625.941.535.433 1.391.869 2.576 1.252 2.36.764 5.71 1.222 9.486 1.222 3.778.0 7.128-.458 9.487-1.222 1.185-.383 2.041-.82 2.576-1.252.528-.427.625-.745.625-.94v-4.394c-.715.37-1.539.673-2.424.922-2.7.76-6.336 1.124-10.264 1.124-3.927.0-7.564-.364-10.263-1.124zm25.576 3.471V7.622c0-2.829-6.856-5.122-15.313-5.122C11.857 2.5 5 4.793 5 7.622v24.756c0 2.829 6.856 5.122 15.313 5.122 8.456.0 15.312-2.293 15.312-5.122v-16.86zM33 19.134c-.7.393-1.505.726-2.375 1.008-2.708.877-6.358 1.352-10.313 1.352-3.954.0-7.604-.475-10.312-1.352-.87-.282-1.676-.615-2.375-1.008v4.28c0 .196.097.514.625.942.535.432 1.391.868 2.576 1.252 2.36.763 5.71 1.221 9.486 1.221 3.778.0 7.128-.458 9.487-1.221 1.185-.384 2.041-.82 2.576-1.252.528-.428.625-.746.625-.941v-4.28zm-23 8.904c-.87-.281-1.676-.615-2.375-1.007v5.143c.044.048.116.117.231.208.447.353 1.252.785 2.48 1.195 2.43.813 5.958 1.362 9.976 1.362 4.019.0 7.546-.549 9.977-1.362 1.228-.41 2.033-.842 2.48-1.195a2.03 2.03.0 00.231-.208v-5.143c-.7.392-1.505.726-2.375 1.007-2.708.877-6.358 1.352-10.313 1.352-3.954.0-7.604-.475-10.312-1.352zm23.06 4.06-.01.016a.059.059.0 01.01-.016zm-25.495.0.01.016a.06.06.0 01-.01-.016zm3.997-15.726c.725.0 1.313-.573 1.313-1.28.0-.708-.588-1.281-1.313-1.281-.724.0-1.312.573-1.312 1.28.0.708.588 1.281 1.313 1.281zm1.313 6.83c0 .706-.588 1.28-1.313 1.28-.724.0-1.312-.574-1.312-1.28.0-.708.588-1.281 1.313-1.281.724.0 1.312.573 1.312 1.28zm-1.313 9.176c.725.0 1.313-.573 1.313-1.28.0-.708-.588-1.28-1.313-1.28-.724.0-1.312.572-1.312 1.28.0.707.588 1.28 1.313 1.28z" clip-rule="evenodd"/></svg></span></div><span class=DocsNavLogoLockup--text><span class=DocsSidebar--docs-title-text-scaler style=--length:2>R2</span></span></div></a><div class="DocsSidebar--section-more Dropdown" data-expanded=false><button class="DocsSidebar--section-more-button Button" aria-expanded=false><div class=DocsSidebar--section-more-button-icon><svg viewBox="0 0 4 16" stroke="currentcolor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" fill="currentcolor" role="img" aria-labelledby="title-6032186738345315" xmlns="http://www.w3.org/2000/svg"><title id="title-6032186738345315">Dropdown icon</title><path d="M2 2v0m0 6v0m0 6v0z"/></svg><span is-visually-hidden>R2 menu</span></div></button><div class="DocsSidebar--section-more-dropdown Dropdown--dropdown"><ul class=Dropdown--list><li class=Dropdown--item><a class=Dropdown--link href=https://cloudflare.com tabindex=-1>Cloudflare homepage</a></li></ul></div></div></div><div class="DocsSidebar--section DocsSidebar--nav-section" style=position:relative;overflow:hidden;width:100%;height:100%><div style=position:absolute;inset:0;overflow-y:auto;margin-right:0;margin-bottom:0><div class=DocsSidebar--nav-section-shadow style=opacity:0></div><ul class=DocsSidebar--nav><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/r2/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Overview</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/r2/get-started/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Get started</span></a></li><li class=DocsSidebar--nav-item is-active-root is-expanded><button class="Button DocsSidebar--nav-expand-collapse-button">
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Data Access</span>
</button><a class=DocsSidebar--nav-link href=/r2/data-access/>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Data Access</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-expanded" style=min-height:0;transition-duration:400ms is-expanded><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=1 style=--depth:1><li class=DocsSidebar--nav-item is-active-root is-expanded><button class="Button DocsSidebar--nav-expand-collapse-button">
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Workers API</span>
</button><a class=DocsSidebar--nav-link href=/r2/data-access/workers-api/>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Workers API</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-expanded" style=min-height:0;transition-duration:400ms is-expanded><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=2 style=--depth:2><li class=DocsSidebar--nav-item is-active><a aria-current=page class=DocsSidebar--nav-link href=/r2/data-access/workers-api/workers-api-usage/ is-active><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Use R2 from Workers</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/r2/data-access/workers-api/workers-multipart-usage/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Use the R2 multipart API from Workers</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/r2/data-access/workers-api/workers-api-reference/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Workers API Reference</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button">
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: S3 API</span>
</button><a class=DocsSidebar--nav-link href=/r2/data-access/s3-api/>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>S3 API</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=2 style=--depth:2><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/r2/data-access/s3-api/api/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>S3 API Compatibility</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/r2/data-access/s3-api/extensions/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Extensions</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/r2/data-access/s3-api/tokens/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Generate an S3 Auth token</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/r2/data-access/s3-api/presigned-urls/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Presigned URLs</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/r2/data-access/public-buckets/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Public Buckets</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button">
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Learning</span>
</button><a class=DocsSidebar--nav-link href=/r2/learning/>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Learning</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=1 style=--depth:1><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/r2/learning/unicode-interoperability/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Filename encoding and interoperability problems</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><button class="Button DocsSidebar--nav-expand-collapse-button">
<span class=DocsSidebar--nav-expand-collapse-button-content aria-hidden=true></span>
<span is-visually-hidden>Expand: Platform</span>
</button><a class=DocsSidebar--nav-link href=/r2/platform/>
<span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Platform</span></a><div class="DocsSidebar--nav-item-collapse-container DocsSidebar--nav-item-collapse-hidden" style=min-height:0><div class=DocsSidebar--nav-item-collapse-wrapper><div class=DocsSidebar--nav-item-collapse-wrapperInner><div class=DocsSidebar--nav-item-collapse-content><ul class=DocsSidebar--nav-subnav depth=1 style=--depth:1><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/r2/platform/pricing/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Pricing</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/r2/platform/limits/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Limits</span></a></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/r2/platform/changelog/ tabindex=-1><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Changelog</span></a></li></ul></div></div></div></div></li><li class=DocsSidebar--nav-item><a class=DocsSidebar--nav-link href=/r2/examples/><span class=DocsSidebar--nav-link-highlight></span>
<span class=DocsSidebar--nav-link-text>Examples</span></a></li></ul></div><div style=position:absolute;height:6px;display:none;right:2px;bottom:2px;left:2px;border-radius:3px><div style=position:relative;display:block;height:100%;cursor:pointer;border-radius:inherit;background-color:rgba(0,0,0,.2)></div></div><div style=position:absolute;width:6px;display:none class="Scrollbars--track Scrollbars--track-vertical"><div style=position:relative;display:block;width:100% class="Scrollbars--thumb Scrollbars--thumb-vertical"></div></div></div><div class=toggleSidebar><button id=toggleSidebarButton style=width:2em;height:2em title="Click to collapse and expand the sidebar navigation"><svg id="toggleSidebarSVG" aria-hidden="true" height="1" width="1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path id="toggleSidebarSVGPath" d="M15 2a1 1 0 00-1 1v10a1 1 0 002 0V3a1 1 0 00-1-1zm-10.407.993-4.3 4.3a1 1 0 000 1.414l4.3 4.3a1 1 0 001.415-1.416L3.417 9H10a1 1 0 100-2H3.417l2.591-2.591A1 1 0 104.593 2.993z"/></svg></button></div></div><div class=DocsSidebar--shadow></div></div><div class=DocsToolbar><div class=DocsToolbar--search><div class=DocsSearch><div class=DocsSearch--input-wrapper><input type=text id=DocsSearch--input class=DocsSearch--input spellcheck=false autocomplete=false placeholder="Search docs..."><div class=DocsSearch--input-icon><svg viewBox="0 0 16 16" fill="currentcolor" role="img" aria-labelledby="title-9701125841014673" xmlns="http://www.w3.org/2000/svg"><title id="title-9701125841014673">Search icon (depiction of a magnifying glass)</title><path d="M11.999 10.585l3.458 3.458a1 1 0 01-1.414 1.414L10.585 12a6.5 6.5.0 111.414-1.414zM6.75 11.5a4.75 4.75.0 100-9.5 4.75 4.75.0 000 9.5z"/></svg></div><button disabled class=slashPlaceholder title="Press '/' to focus on the search bar" aria-label="Forward slash keyboard shortcut" tabindex=-1 type=button><div style=margin-top:-1px>/</span></div></button></div></div></div><div class=DocsToolbar--tools><button data-feedback=true class="DocsToolbar--feedback Button Button-is-docs-secondary">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17"><path d="M14 2.5H2l-.5.5v11.165l.863.345 2.852-3.01H14l.5-.5V3l-.5-.5zm-.5 8H4.785L2.5 12.911V3.5h11v7z" fill="currentcolor"/><path d="M12.5 5.003h-9v1h9v-1zm0 2.497h-9v1h9v-1z" fill="currentcolor"/></svg>Give Feedback</button><div class=DocsToolbar--tools-spacer></div><div class=DocsToolbar--tools-icon-item><div class=Tooltip---root><div class=DocsToolbar--tools-icon-item-content><a class="Link Link-without-underline" href=https://github.com/cloudflare/cloudflare-docs><svg viewBox="0 0 16 16" fill="currentcolor" role="img" aria-labelledby="title-6991762763429039" xmlns="http://www.w3.org/2000/svg"><title id="title-6991762763429039">GitHub icon</title><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z" fill-rule="evenodd"/></svg></a></div><span class=Tooltip role=tooltip position=bottom-end>Visit R2 on GitHub</span></div></div><div class=DocsToolbar--tools-spacer></div><div class=DocsToolbar--theme-toggle><div class=Tooltip---root><div class=ThemeToggle><input type=checkbox id=ThemeToggle class=ThemeToggle--input>
<label class=ThemeToggle--toggle for=ThemeToggle><div class=ThemeToggle--toggle-handle></div><div class="ThemeToggle--toggle-handle-icon ThemeToggle--sun"><svg viewBox="0 0 16 16" fill="currentcolor" role="img" aria-labelledby="title-8812071124069258" xmlns="http://www.w3.org/2000/svg"><title id="title-8812071124069258">Light theme icon (depiction of a sun)</title><path d="M7.5 11.465a3.482 3.482.0 01-1.596-.662L4.11 12.596a.5.5.0 01-.707-.707l1.793-1.793A3.482 3.482.0 014.535 8.5H2a.5.5.0 010-1h2.535a3.482 3.482.0 01.662-1.596L3.404 4.11a.5.5.0 01.707-.707l1.793 1.793A3.482 3.482.0 017.5 4.535V2a.5.5.0 011 0v2.535a3.482 3.482.0 011.596.662l1.793-1.793a.5.5.0 01.707.707l-1.793 1.793c.343.458.577 1.003.662 1.596H14a.5.5.0 110 1h-2.535a3.482 3.482.0 01-.662 1.596l1.793 1.793a.5.5.0 01-.707.707l-1.793-1.793a3.482 3.482.0 01-1.596.662V14a.5.5.0 11-1 0v-2.535z"/></svg></div><div class="ThemeToggle--toggle-handle-icon ThemeToggle--moon"><svg viewBox="0 0 16 16" fill="currentcolor" role="img" aria-labelledby="title-5971296394189265" xmlns="http://www.w3.org/2000/svg"><title id="title-5971296394189265">Dark theme icon (depiction of a moon)</title><path d="M7.067 3.087a5 5 0 005.466 7.026A5 5 0 117.067 3.087z"/></svg></div></label><span class=Tooltip role=tooltip position=bottom-end>Set theme to dark (‚áß+D)</span></div></div></div></div></div><main class=DocsBody><div class=DocsBody--sidebar with-styled-webkit-scrollbars><div class=DocsBody--sidebar-content-scroll-fade></div><div class=DocsBody--sidebar-content><ul class=DocsTableOfContents hidden><li><a class=DocsTableOfContents-link href=#docs-content>‚Üë Top</a></li></ul></nav></div></div><div id=docs-content data-reach-skip-nav-content></div><div class=DocsContent id=main page-type=document><article class=DocsMarkdown><h1 id=use-r2-from-workers>Use R2 from Workers</h1><h2 id=1-install-wrangler><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#1-install-wrangler>&#8203;‚Äã</a></span>
<span>1. Install Wrangler</span></h2><aside class=DocsMarkdown--aside role=note data-type=note>This guide is tailored to Wrangler 2. If you are still using Wrangler 1, refer to the <a href=/workers/wrangler/migration/migrating-from-wrangler-1/ class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Migrate from Wrangler 1 guide</span></a>.</aside><p>To create your R2 bucket, install <a href=/workers/get-started/guide/#2-install-the-workers-cli class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Wrangler</span></a>, the Workers CLI.</p><p>To install <a href=https://github.com/cloudflare/wrangler class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content><code>wrangler</code></span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span>
</span></a>, ensure you have <a href=https://docs.npmjs.com/getting-started class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content><code>npm</code> installed</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span>
</span></a>. Use a Node version manager like <a href=https://volta.sh/ class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Volta</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> or <a href=https://github.com/nvm-sh/nvm class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>nvm</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a> to avoid permission issues or to easily change Node.js versions, then run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ npm install -g wrangler
</span></span></code></pre></div><p>or install with yarn:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ yarn global add wrangler
</span></span></code></pre></div><p>Refer to the Wrangler <a href=/workers/wrangler/install-and-update/ class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Install/Update</span></a> page for more information.</p><h2 id=2-authenticate-wrangler><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#2-authenticate-wrangler>&#8203;‚Äã</a></span>
<span>2. Authenticate Wrangler</span></h2><p>With installation complete, <code>wrangler</code> will need access to a Cloudflare OAuth token to manage Workers resources on your behalf.</p><p>Run the command <code>wrangler login</code>, which will automate this process.</p><p>Wrangler will attempt to automatically open your web browser to complete the login process to your Cloudflare account. If you have issues completing this step or you do not have access to a browser GUI, you can copy and paste the URL generated by <code>wrangler login</code> in your terminal into a browser and log in.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ wrangler login
</span></span><span class=line><span class=cl>Allow Wrangler to open a page in your browser? <span class=o>[</span>y/n<span class=o>]</span>
</span></span><span class=line><span class=cl>y
</span></span><span class=line><span class=cl>üíÅ  Opened a link in your default browser: https://dash.cloudflare.com/oauth2/...
</span></span></code></pre></div><p>Open the browser, log in to your account, and select <strong>Allow</strong>. This will send an OAuth Token to Wrangler so it can deploy your scripts to Cloudflare.</p><aside class=DocsMarkdown--aside role=note data-type=note>R2 requires a Wrangler version of <code>1.19.8</code> or higher. To check your Wrangler version, run <code>wrangler --version</code>.</aside><h2 id=3-create-your-bucket><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#3-create-your-bucket>&#8203;‚Äã</a></span>
<span>3. Create your bucket</span></h2><p>Create your bucket by running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ wrangler r2 bucket create &lt;YOUR_BUCKET_NAME&gt;
</span></span></code></pre></div><p>To check that your bucket was created, run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ wrangler r2 bucket list
</span></span></code></pre></div><p>After running the <code>list</code> command, you will see all bucket names, including the one you have just created.</p><h2 id=4-bind-your-bucket-to-a-worker><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#4-bind-your-bucket-to-a-worker>&#8203;‚Äã</a></span>
<span>4. Bind your bucket to a Worker</span></h2><p>You will need to bind your bucket to a Worker.</p><aside class=DocsMarkdown--aside role=note data-type=note><div class=DocsMarkdown--aside-header>Bindings</div><p>A binding is a how your Worker interacts with external resources such as <a href=/workers/runtime-apis/kv/ class=DocsMarkdown--link><span class=DocsMarkdown--link-content>KV Namespaces</span></a>, <a href=/workers/runtime-apis/durable-objects/ class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Durable Objects</span></a>, or <a href=#api class=DocsMarkdown--link><span class=DocsMarkdown--link-content>R2 Buckets</span></a>. A binding is a runtime variable that the Workers runtime provides to your code. You can declare a variable name in your <code>wrangler.toml</code> file that will be bound to these resources at runtime, and interact with them through this variable. Every binding&rsquo;s variable name and behavior is determined by you when deploying the Worker. Refer to the <a href=/workers/platform/environment-variables/ class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Environment Variables</span></a> documentation for more information.</p><p>A binding is defined in the <code>wrangler.toml</code> file of your Worker project&rsquo;s directory.</p></aside><p>Create a Worker using a <a href=/workers/get-started/quickstarts/#templates class=DocsMarkdown--link><span class=DocsMarkdown--link-content>template</span></a>. Wrangler templates are git repositories that are designed to be a starting point for building a new Cloudflare Workers project.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ wrangler init &lt;YOUR_WORKER_NAME&gt;
</span></span></code></pre></div><p>Next, find your newly generated <code>wrangler.toml</code> file in your project&rsquo;s directory and update <code>account_id</code> with your Cloudflare Account ID.</p><p>Find your Account ID by logging in to the Cloudflare dashboard > <strong>Overview</strong> > move down to <strong>API</strong> > and select <strong>Click to copy</strong> to copy your <strong>Account ID</strong>. Or run the <code>wrangler whoami</code> command <a href=/workers/get-started/guide/#6-preview-your-project class=DocsMarkdown--link><span class=DocsMarkdown--link-content>to copy your Account ID</span></a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=nx>name</span> <span class=p>=</span> <span class=s2>&#34;&lt;YOUR_WORKER_NAME&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>main</span> <span class=p>=</span> <span class=s2>&#34;src/index.js&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>compatibility_date</span> <span class=p>=</span> <span class=s2>&#34;2022-06-30&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>account_id</span> <span class=p>=</span> <span class=s2>&#34;YOUR_ACCOUNT_ID&#34;</span> <span class=c># ‚Üê Replace with your Account ID.</span>
</span></span><span class=line><span class=cl><span class=nx>workers_dev</span> <span class=p>=</span> <span class=kc>true</span>
</span></span></code></pre></div><p>To bind your R2 bucket to your Worker, add the following to your <code>wrangler.toml</code> file. Update the <code>binding</code> property to a valid JavaScript variable identifier and <code>bucket_name</code> to the <code>&lt;YOUR_BUCKET_NAME></code> you used to create your bucket in <a href=#create-your-bucket class=DocsMarkdown--link><span class=DocsMarkdown--link-content>step 3</span></a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[[</span><span class=nx>r2_buckets</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=nx>binding</span> <span class=p>=</span> <span class=s1>&#39;MY_BUCKET&#39;</span> <span class=c># &lt;~ valid JavaScript variable name</span>
</span></span><span class=line><span class=cl><span class=nx>bucket_name</span> <span class=p>=</span> <span class=s1>&#39;&lt;YOUR_BUCKET_NAME&gt;&#39;</span>
</span></span></code></pre></div><p>Find more detailed information on configuring your Worker in the <a href=/workers/wrangler/cli-wrangler/configuration/ class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Wrangler Configuration documentation</span></a>.</p><h2 id=5-access-your-r2-bucket-from-your-worker><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#5-access-your-r2-bucket-from-your-worker>&#8203;‚Äã</a></span>
<span>5. Access your R2 bucket from your Worker</span></h2><p>Within your Worker code, your bucket is now available under the <code>MY_BUCKET</code> variable and you can begin interacting with it.</p><p>An R2 bucket is able to READ, LIST, WRITE, and DELETE objects. You can see an example of all operations below using the Module Worker syntax. Add the following snippet into your project&rsquo;s <code>index.js</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>fetch</span><span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>env</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>url</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>URL</span><span class=p>(</span><span class=nx>request</span><span class=p>.</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>key</span> <span class=o>=</span> <span class=nx>url</span><span class=p>.</span><span class=nx>pathname</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=nx>request</span><span class=p>.</span><span class=nx>method</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;PUT&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>env</span><span class=p>.</span><span class=nx>MY_BUCKET</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=nx>key</span><span class=p>,</span> <span class=nx>request</span><span class=p>.</span><span class=nx>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=sb>`Put </span><span class=si>${</span><span class=nx>key</span><span class=si>}</span><span class=sb> successfully!`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;GET&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>object</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>env</span><span class=p>.</span><span class=nx>MY_BUCKET</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>object</span> <span class=o>===</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=s1>&#39;Object Not Found&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>status</span><span class=o>:</span> <span class=mi>404</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>headers</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Headers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>object</span><span class=p>.</span><span class=nx>writeHttpMetadata</span><span class=p>(</span><span class=nx>headers</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>headers</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s1>&#39;etag&#39;</span><span class=p>,</span> <span class=nx>object</span><span class=p>.</span><span class=nx>httpEtag</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=nx>object</span><span class=p>.</span><span class=nx>body</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>headers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s1>&#39;DELETE&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>env</span><span class=p>.</span><span class=nx>MY_BUCKET</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=nx>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=s1>&#39;Deleted!&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=s1>&#39;Method Not Allowed&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>status</span><span class=o>:</span> <span class=mi>405</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>Allow</span><span class=o>:</span> <span class=s1>&#39;PUT, GET, DELETE&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h2 id=6-bucket-access-and-privacy><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#6-bucket-access-and-privacy>&#8203;‚Äã</a></span>
<span>6. Bucket access and privacy</span></h2><p>With the above code added to your Worker, every incoming request has the ability to interact with your bucket. This means your bucket is publicly exposed and its contents can be accessed and modified by undesired actors.</p><p>You must now define authorization logic to determine who can perform what actions to your bucket. This logic lives within your Worker&rsquo;s code, as it is your application&rsquo;s job to determine user privileges. The following is a short list of resources related to access and authorization practices:</p><ol><li><a href=/workers/examples/basic-auth/ class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Basic Authentication</span></a>: Shows how to restrict access using the HTTP Basic schema.</li><li><a href=/workers/examples/auth-with-headers/ class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Using Custom Headers</span></a>: Allow or deny a request based on a known pre-shared key in a header.</li></ol><p>Continuing with your newly created bucket and Worker, you will need to protect all bucket operations.</p><p>For <code>PUT</code> and <code>DELETE</code> requests, you will make use of a new <code>AUTH_KEY_SECRET</code> environment variable, which you will define later as a Wrangler secret.</p><p>For <code>GET</code> requests, you will ensure that only a specific file can be requested. All of this custom logic occurs inside of an <code>authorizeRequest</code> function, with the <code>hasValidHeader</code> function handling the custom header logic. If all validation passes, then the operation is allowed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>ALLOW_LIST</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;cat-pic.jpg&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Check requests for a pre-shared secret
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>hasValidHeader</span> <span class=o>=</span> <span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>env</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>request</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;X-Custom-Auth-Key&#39;</span><span class=p>)</span> <span class=o>===</span> <span class=nx>env</span><span class=p>.</span><span class=nx>AUTH_KEY_SECRET</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>authorizeRequest</span><span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>env</span><span class=p>,</span> <span class=nx>key</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nx>request</span><span class=p>.</span><span class=nx>method</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;PUT&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;DELETE&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>hasValidHeader</span><span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>env</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;GET&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>ALLOW_LIST</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>fetch</span><span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>env</span><span class=p>,</span> <span class=nx>ctx</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>url</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>URL</span><span class=p>(</span><span class=nx>request</span><span class=p>.</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>key</span> <span class=o>=</span> <span class=nx>url</span><span class=p>.</span><span class=nx>pathname</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>authorizeRequest</span><span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>env</span><span class=p>,</span> <span class=nx>key</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=s1>&#39;Forbidden&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>status</span><span class=o>:</span> <span class=mi>403</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>For this to work, you need to create a secret via Wrangler:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ wrangler secret put AUTH_KEY_SECRET
</span></span></code></pre></div><p>This command will prompt you to enter a secret in your terminal:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ wrangler secret put AUTH_KEY_SECRET
</span></span><span class=line><span class=cl>Enter the secret text you<span class=err>&#39;</span>d like assigned to the variable AUTH_KEY_SECRET on the script named &lt;YOUR_WORKER_NAME&gt;:
</span></span><span class=line><span class=cl>*********
</span></span><span class=line><span class=cl>üåÄ  Creating the secret <span class=k>for</span> script name &lt;YOUR_WORKER_NAME&gt;
</span></span><span class=line><span class=cl>‚ú®  Success! Uploaded secret AUTH_KEY_SECRET.
</span></span></code></pre></div><p>This secret is now available as the global variable <code>AUTH_KEY_SECRET</code> in your Worker.</p><h2 id=7-deploy-your-bucket><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#7-deploy-your-bucket>&#8203;‚Äã</a></span>
<span>7. Deploy your bucket</span></h2><p>With your Worker and bucket set up, run the <code>wrangler publish</code> <a href=/workers/wrangler/cli-wrangler/commands/#publish class=DocsMarkdown--link><span class=DocsMarkdown--link-content>command</span></a> to deploy to Cloudflare&rsquo;s global network:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ wrangler publish
</span></span></code></pre></div><p>You can verify your authorization logic is working through the following commands, using your deployed Worker endpoint:</p><aside class=DocsMarkdown--aside role=note data-type=warning><p>When uploading files to R2 via <code>curl</code>, ensure you use <strong><a href=https://everything.curl.dev/http/post/binary class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content><code>--data-binary</code></span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></strong> instead of <code>--data</code> or <code>-d</code>. Files will otherwise be truncated.</p></aside><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Attempt to write an object without providing the &#34;X-Custom-Auth-Key&#34; header</span>
</span></span><span class=line><span class=cl>$ curl https://your-worker.dev/cat-pic.jpg -X PUT --data-binary <span class=s1>&#39;test&#39;</span>
</span></span><span class=line><span class=cl><span class=c1>#=&gt; Forbidden</span>
</span></span><span class=line><span class=cl><span class=c1># Expected because header was missing</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Attempt to write an object with the wrong &#34;X-Custom-Auth-Key&#34; header value</span>
</span></span><span class=line><span class=cl>$ curl https://your-worker.dev/cat-pic.jpg -X PUT --header <span class=s2>&#34;X-Custom-Auth-Key: hotdog&#34;</span> --data-binary <span class=s1>&#39;test&#39;</span>
</span></span><span class=line><span class=cl><span class=c1>#=&gt; Forbidden</span>
</span></span><span class=line><span class=cl><span class=c1># Expected because header value did not match the AUTH_KEY_SECRET value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Attempt to write an object with the correct &#34;X-Custom-Auth-Key&#34; header value</span>
</span></span><span class=line><span class=cl><span class=c1># Note: Assume that &#34;*********&#34; is the value of your AUTH_KEY_SECRET Wrangler secret</span>
</span></span><span class=line><span class=cl>$ curl https://your-worker.dev/cat-pic.jpg -X PUT --header <span class=s2>&#34;X-Custom-Auth-Key: *********&#34;</span> --data-binary <span class=s1>&#39;test&#39;</span>
</span></span><span class=line><span class=cl><span class=c1>#=&gt; Put cat-pic.jpg successfully!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Attempt to read object called &#34;foo&#34;</span>
</span></span><span class=line><span class=cl>$ curl https://your-worker.dev/foo
</span></span><span class=line><span class=cl><span class=c1>#=&gt; Forbidden</span>
</span></span><span class=line><span class=cl><span class=c1># Expected because &#34;foo&#34; is not in the ALLOW_LIST</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Attempt to read an object called &#34;cat-pic.jpg&#34;</span>
</span></span><span class=line><span class=cl>$ curl https://your-worker.dev/cat-pic.jpg
</span></span><span class=line><span class=cl><span class=c1>#=&gt; test</span>
</span></span><span class=line><span class=cl><span class=c1># Note: This is the value that was successfully PUT above</span>
</span></span></code></pre></div><p>By completing this guide, you have successfully installed Wrangler and deployed your R2 bucket to Cloudflare.</p><h2 id=related-resources><span class=DocsMarkdown--header-anchor-positioner><a class="DocsMarkdown--header-anchor Link Link-without-underline" href=#related-resources>&#8203;‚Äã</a></span>
<span>Related resources</span></h2><ol><li><a href=/workers/tutorials/ class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Workers Tutorials</span></a></li><li><a href=/workers/examples/ class=DocsMarkdown--link><span class=DocsMarkdown--link-content>Workers Examples</span></a></li></ol></article></div></main><footer class=DocsFooter><div class=DocsFooter--content><div class=DocsFooterResources><span class=DocsFooter--content-additional-wrapper><a href="https://dash.cloudflare.com/?to=/:account/r2" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Cloudflare Dashboard</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; ¬∑ &nbsp;</span>
<span class=DocsFooter--content-additional-wrapper><a href=https://discord.com/channels/595317990191398933/940663374377783388 class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Discord</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; ¬∑ &nbsp;</span>
<span class=DocsFooter--content-additional-wrapper><a href=https://community.cloudflare.com/c/developers/workers/40 class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Community</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; ¬∑ &nbsp;</span>
<span class=DocsFooter--content-additional-wrapper><a href=https://www.cloudflare.com/learning/ class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Learning Center</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; ¬∑ &nbsp;</span>
<span class=DocsFooter--content-additional-wrapper><a href="https://dash.cloudflare.com/?to=/:account/support" class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Support Portal</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span></div><div><span class=DocsFooter--edit-on-gh-link-wrapper><a href=https://github.com/panthere2k/cf-docs/blob/main/content/r2/data-access/workers-api/workers-api-usage.md class=DocsMarkdown--link target=_blank rel=noopener><span class=DocsMarkdown--link-content>Edit on GitHub</span><span class=DocsMarkdown--link-external-icon aria-hidden=true><svg fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16" role="img" aria-labelledby="title-4744738674102027" xmlns="http://www.w3.org/2000/svg"><title id="title-4744738674102027">External link icon</title><path d="M6.75 1.75h-5v12.5h12.5v-5m0-4v-3.5h-3.5M8 8l5.5-5.5"/></svg>
<span is-visually-hidden>Open external link</span></span></a></span>
<span class=DocsFooter--content-dot-spacer>&nbsp; ¬∑ &nbsp;</span>
<span class=DocsFooter--content-time>Updated <time class=relative datetime=2023-01-02T09:58:19+09:00 title=2023-01-02>January 2, 2023</time></span></div></div></footer></div><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PKQFGQB" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-PKQFGQB")</script><link rel=preload href=https://unpkg.com/littlefoot/dist/littlefoot.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=preload href=https://unpkg.com/littlefoot/dist/littlefoot.css as=style></noscript><script defer src=https://unpkg.com/littlefoot/dist/littlefoot.js type=application/javascript></script>
<script type=application/javascript>document.addEventListener("DOMContentLoaded",()=>littlefoot.default())</script></body></html>